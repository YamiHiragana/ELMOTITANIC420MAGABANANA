<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Solana Wallet Connector</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        background-color: #f0f4f8;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        height: 100vh;
        margin: 0;
      }

      h1 {
        color: #333;
        margin-bottom: 20px;
      }

      #connect-button {
        padding: 15px 30px;
        background-color: #805ad5;
        color: white;
        border: none;
        border-radius: 8px;
        font-size: 1.2em;
        cursor: pointer;
        transition: background-color 0.3s;
      }

      #connect-button:hover {
        background-color: #6b46c1;
      }

      #wallet-info {
        margin-top: 30px;
        text-align: center;
        background-color: #fff;
        padding: 20px 30px;
        border-radius: 10px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      }

      .info-item {
        margin: 15px 0;
        font-size: 1.1em;
        word-break: break-all;
      }

      #error-message {
        margin-top: 20px;
        color: red;
        font-size: 1em;
      }

      a {
        color: #805ad5;
        text-decoration: none;
      }

      a:hover {
        text-decoration: underline;
      }
    </style>
  </head>
  <body>
    <h1>Connect Your Solana Wallet</h1>
    <button id="connect-button">Connect Phantom Wallet</button>

    <div id="wallet-info" style="display: none">
      <div class="info-item">
        <strong>Public Key:</strong> <span id="public-key"></span>
      </div>
      <div class="info-item">
        <strong>SOL Balance:</strong> <span id="sol-balance"></span> SOL
      </div>
    </div>

    <div id="error-message"></div>

    <!-- Include Solana Web3.js via CDN -->
    <script src="https://unpkg.com/@solana/web3.js@latest/lib/index.iife.js"></script>

    <script>
      // Check if Phantom Wallet is installed
      const isPhantomInstalled = window.solana && window.solana.isPhantom;

      const connectButton = document.getElementById("connect-button");
      const walletInfo = document.getElementById("wallet-info");
      const publicKeySpan = document.getElementById("public-key");
      const solBalanceSpan = document.getElementById("sol-balance");
      const errorMessage = document.getElementById("error-message");

      // Function to connect to Phantom Wallet
      const connectWallet = async () => {
        if (!isPhantomInstalled) {
          errorMessage.innerHTML =
            'Phantom Wallet is not installed. Please install it from <a href="https://phantom.app/" target="_blank">here</a>.';
          return;
        }

        try {
          // Request wallet connection
          const response = await window.solana.connect();
          const publicKey = response.publicKey.toString();
          publicKeySpan.textContent = publicKey;

          // Create a connection to the Solana mainnet
          const connection = new solanaWeb3.Connection(
            solanaWeb3.clusterApiUrl("mainnet-beta"),
            "confirmed"
          );

          // Fetch SOL balance
          const balance = await connection.getBalance(
            new solanaWeb3.PublicKey(publicKey)
          );
          const solBalance = balance / solanaWeb3.LAMPORTS_PER_SOL;
          solBalanceSpan.textContent = solBalance;

          // Display wallet information
          walletInfo.style.display = "block";
          errorMessage.textContent = "";

          // Optionally, disable the connect button after successful connection
          connectButton.disabled = true;
          connectButton.textContent = "Wallet Connected";
        } catch (err) {
          console.error(err);
          errorMessage.textContent = "Failed to connect to Phantom Wallet.";
        }
      };

      // Add event listener to the connect button
      connectButton.addEventListener("click", connectWallet);

      // Optional: Listen for account changes (e.g., user switches accounts or networks)
      if (isPhantomInstalled) {
        window.solana.on("accountChanged", (newPublicKey) => {
          if (newPublicKey) {
            // If a new account is connected, reload the page to update the balance
            window.location.reload();
          } else {
            // If the wallet is disconnected, reload the page
            window.location.reload();
          }
        });
      }
    </script>
  </body>
</html>
